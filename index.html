<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Day Matcha</title>
    
    <link rel="icon" href="https://raw.githubusercontent.com/Nanthe27/MyDayMatcha/a10b4d4f580a0e014e57221c0b136abf501a8d1f/Logo.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Nanthe27/MyDayMatcha/a10b4d4f580a0e014e57221c0b136abf501a8d1f/Logo.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. VARIABLES --- */
        :root {
            --primary: #2e7d32;
            --primary-soft: rgba(46, 125, 50, 0.08);
            --bg: #F2F4F6;
            --surface: #FFFFFF;
            --text: #1a1a1a;
            --text-sec: #8e8e93;
            --radius-lg: 24px;
            --radius-md: 16px;
            --spacing: 20px;
            --shadow: 0 12px 40px rgba(0, 0, 0, 0.04);
            --anim: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg: #000000; --surface: #1c1c1e; --text: #ffffff;
            --text-sec: #98989d; --primary-soft: rgba(255, 255, 255, 0.1);
            --shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", "Segoe UI", Roboto, sans-serif;
            background: var(--bg); color: var(--text);
            margin: 0; padding: 0; height: 100vh; width: 100vw;
            display: flex; flex-direction: column; overflow: hidden;
            transition: background 0.4s var(--anim), color 0.4s var(--anim);
        }

        /* --- 2. HEADER --- */
        .app-header {
            height: 70px; padding: 0 var(--spacing);
            display: flex; justify-content: space-between; align-items: center;
            background: transparent; z-index: 50; flex-shrink: 0;
        }
        
        .brand { 
            font-family: 'Quicksand', sans-serif;
            font-size: 20px; font-weight: 700; color: var(--text); letter-spacing: -0.5px;
            display: flex; align-items: center; 
            backdrop-filter: blur(20px);
            padding: 8px 16px 8px 8px; border-radius: 100px;
            background: var(--surface); box-shadow: var(--shadow);
        }
        
        .app-logo { 
            height: 36px; width: 36px; border-radius: 50%; margin-right: 12px; 
            object-fit: cover; background: var(--bg);
        }

        .header-actions { 
            display: flex; gap: 12px; 
            background: var(--surface); padding: 6px; border-radius: 100px;
            box-shadow: var(--shadow);
        }
        
        .icon-btn {
            background: transparent; border: none; font-size: 18px; cursor: pointer;
            width: 40px; height: 40px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            color: var(--text); transition: transform 0.2s var(--anim), background 0.2s;
        }
        .icon-btn:hover { background: var(--bg); transform: scale(1.05); }
        .icon-btn:active { transform: scale(0.9); }

        /* --- 3. MAIN STAGE (DESKTOP DEFAULT) --- */
        .main-stage {
            flex: 1; padding: 0 var(--spacing) var(--spacing) var(--spacing);
            display: grid; 
            grid-template-columns: 1.6fr 1fr;
            gap: var(--spacing);
            overflow: hidden;
        }

        /* MENU (DESKTOP) */
        .menu-area {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 24px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            grid-auto-rows: 90px;
            gap: 16px;
            box-shadow: var(--shadow);
            align-content: start;
        }

        /* BUTTONS (DESKTOP) */
        .drink-btn {
            background: var(--card-color); color: white;
            border: none; border-radius: var(--radius-md);
            width: 100%; height: 100%;
            padding: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 14px; font-weight: 700; line-height: 1.3; text-align: center;
            position: relative; cursor: pointer; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s var(--anim);
            background-image: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
        }
        .drink-btn:hover { transform: translateY(-4px) scale(1.02); z-index: 2; }
        .drink-btn:active { transform: scale(0.95); }

        /* Animations */
        @keyframes floatUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .drink-btn { animation: floatUp 0.6s var(--anim) backwards; }
        .drink-btn:nth-child(odd) { animation-delay: 0.1s; }
        .drink-btn:nth-child(even) { animation-delay: 0.2s; }

        /* CART (DESKTOP) */
        .cart-area {
            background: var(--surface);
            border-radius: var(--radius-lg);
            display: flex; flex-direction: column;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .cart-header {
            padding: 24px 24px 10px 24px;
            font-size: 11px; font-weight: 800; color: var(--text-sec);
            text-transform: uppercase; letter-spacing: 2px;
        }
        
        .cart-list { flex: 1; overflow-y: auto; padding: 0 24px; scrollbar-width: none; }
        .cart-list::-webkit-scrollbar { display: none; }

        .cart-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 0; border-bottom: 1px solid var(--primary-soft);
            animation: floatUp 0.4s var(--anim);
        }

        .item-left { display: flex; align-items: center; gap: 8px; flex: 1; overflow: hidden; }
        .item-name {
            font-size: 14px; font-weight: 600; color: var(--text);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px;
        }

        .mini-select {
            background: var(--bg); border: none;
            border-radius: 8px; font-size: 11px; font-weight: 600;
            color: var(--text); padding: 4px 8px; text-align: center;
            outline: none; cursor: pointer; appearance: none;
        }

        .item-right { display: flex; align-items: center; gap: 12px; }
        .item-price { font-weight: 700; font-size: 14px; color: var(--text); }
        
        .del-btn {
            color: var(--text-sec); background: transparent; border: none;
            font-size: 20px; font-weight: 400; cursor: pointer; padding: 0;
        }
        .del-btn:hover { color: #FF3B30; }

        .cart-footer { padding: 24px; background: var(--surface); }
        
        .total-row {
            display: flex; justify-content: space-between; align-items: baseline;
            margin-bottom: 20px;
        }
        .total-label { font-size: 14px; color: var(--text-sec); font-weight: 600; }
        .total-display { font-size: 28px; font-weight: 800; color: var(--primary); letter-spacing: -1px; }

        .controls { display: grid; grid-template-columns: 1fr 2fr; gap: 12px; }
        .btn { 
            padding: 16px; border: none; border-radius: var(--radius-md); 
            font-weight: 700; font-size: 15px; cursor: pointer; 
            transition: transform 0.2s var(--anim), box-shadow 0.2s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-confirm { background: var(--primary); color: white; box-shadow: 0 8px 20px rgba(46, 125, 50, 0.15); }
        .btn-clear { background: var(--bg); color: var(--text); }

        /* --- 4. MOBILE TRANSFORMATION --- */
        @media (max-width: 768px) {
            :root { --spacing: 0px; --radius-lg: 20px; }
            
            .app-header { padding: 0 20px; height: 60px; }
            .brand { box-shadow: none; background: transparent; padding: 0; }
            .header-actions { box-shadow: none; background: transparent; padding: 0; }

            .main-stage {
                display: block; position: relative;
            }

            /* MENU: Full Screen Scroll */
            .menu-area {
                border-radius: 0; box-shadow: none;
                width: 100%;
                height: calc(100vh - 60px); 
                padding: 10px 20px 80px 20px; /* Space for mini bar */
                background: transparent;
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-auto-rows: min-content;
                gap: 10px;
                align-content: start;
                overflow-y: auto;
            }

            .drink-btn {
                width: 100%; height: 45px; max-height: 45px; padding: 5px;
                font-size: 13px; border-radius: 16px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            }

            /* CART: Floating Mini Bar */
            .cart-area {
                position: fixed; 
                bottom: 0; left: 0; width: 100%;
                height: 60px; /* Collapsed Height */
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
                border: none;
                z-index: 100;
                transition: height 0.4s cubic-bezier(0.2, 0.9, 0.1, 1);
                
                background: var(--primary);
                color: white;
            }
            
            .cart-header {
                height: 60px; padding: 0 25px;
                display: flex; justify-content: space-between; align-items: center;
                cursor: pointer; border-bottom: none;
                color: white; 
                position: relative;
            }
            
            /* --- VISUAL CUE: THE HANDLE --- */
            .cart-header::before {
                content: ''; position: absolute; top: 8px; left: 50%; transform: translateX(-50%);
                width: 50px; height: 6px; /* Wider and thicker handle */
                background: rgba(255,255,255,0.4); /* Semi-transparent white on green */
                border-radius: 10px;
                transition: background 0.3s;
            }

            /* --- VISUAL CUE: THE BOUNCING ARROW --- */
            @keyframes bounceArrow {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-4px); }
            }

            .cart-arrow {
                font-size: 18px; /* Larger arrow */
                font-weight: bold;
                animation: bounceArrow 1.5s infinite ease-in-out; /* Bouncing attention grabber */
                margin-left: 10px;
            }

            /* Hide internals when collapsed */
            .cart-area:not(.expanded) .cart-list,
            .cart-area:not(.expanded) .cart-footer { display: none; }

            /* EXPANDED STATE (FULL SCREEN) */
            .cart-area.expanded {
                height: 100%; 
                background: var(--surface); 
                color: var(--text);
            }
            
            .cart-area.expanded .cart-header {
                color: var(--text-sec);
                border-bottom: 1px solid var(--primary-soft);
                padding-top: 40px; 
                align-items: flex-end; 
                height: 90px;
            }
            
            /* Change handle color when expanded (White background) */
            .cart-area.expanded .cart-header::before {
                background: rgba(0,0,0,0.1); 
                top: 12px;
            }

            /* Stop bouncing and rotate arrow when expanded */
            .cart-area.expanded .cart-arrow { 
                animation: none;
                transform: rotate(180deg); 
                color: var(--primary); 
            }

            .mobile-summary { display: inline; font-size: 16px; font-weight: 700; }
            .desktop-title { display: none; }
            
            .cart-area.expanded .cart-list { display: block; padding-top: 10px; }
            .cart-area.expanded .cart-footer { display: block; padding-bottom: 30px; }
        }
        
        @media (min-width: 769px) {
            .mobile-summary { display: none; }
            .cart-arrow { display: none; }
        }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 200; 
            display: none; align-items: center; justify-content: center; 
            backdrop-filter: blur(8px); opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.open { opacity: 1; }
        
        .modal-box {
            background: var(--surface); width: 85%; max-width: 340px; padding: 30px;
            border-radius: 24px; color: var(--text); text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            transform: scale(0.9); transition: transform 0.4s var(--anim);
        }
        .modal-overlay.open .modal-box { transform: scale(1); }
        
        #historyPage { z-index: 150; background: var(--bg); }
        #historyPage .app-header { background: var(--surface); box-shadow: var(--shadow); }

    </style>
</head>
<body>

    <header class="app-header">
        <div class="brand">
            <img src="https://raw.githubusercontent.com/Nanthe27/MyDayMatcha/a10b4d4f580a0e014e57221c0b136abf501a8d1f/Logo.png" class="app-logo">
            My Day Matcha
        </div>
        <div class="header-actions">
            <button class="icon-btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
            <button class="icon-btn" onclick="openHistory()">üïí</button>
        </div>
    </header>

    <div class="main-stage">
        <div class="menu-area" id="menuArea"></div>

        <div class="cart-area" id="cartSheet">
            <div class="cart-header" onclick="toggleCart()">
                <span class="mobile-summary" id="mobileSummary">0 Items ‚Ä¢ 0 KHR</span>
                
                <span class="desktop-title">Current Order</span>
                
                <span class="cart-arrow">‚ñ≤</span>
            </div>
            
            <div class="cart-list" id="cartList"></div>
            
            <div class="cart-footer">
                <div class="total-row">
                    <span class="total-label">Total</span>
                    <span class="total-display" id="totalDisplay">0</span>
                </div>
                <div class="controls">
                    <button class="btn btn-clear" onclick="confirmClear()">Clear</button>
                    <button class="btn btn-confirm" onclick="confirmOrder()">Confirm Order</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="mTitle" style="margin:0 0 10px 0; font-size:20px;">Title</h3>
            <p id="mText" style="color:var(--text-sec); font-size:15px; margin-bottom:25px; line-height:1.5;">Text</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <button class="btn btn-clear" style="padding:12px;" onclick="closeModal()">Cancel</button>
                <button class="btn btn-confirm" style="padding:12px;" id="mBtn">Yes</button>
            </div>
        </div>
    </div>

    <div id="historyPage" class="modal-overlay" style="display:none; flex-direction:column; justify-content:start;">
        <div class="app-header" style="width:100%;">
            <button class="icon-btn" onclick="document.getElementById('historyPage').classList.remove('open'); setTimeout(()=>document.getElementById('historyPage').style.display='none',300)">‚úï</button>
            <span style="font-weight:800; font-size:18px;">Today's Sales</span>
            <button class="icon-btn" style="color:#FF3B30;" onclick="resetHistory()">üóëÔ∏è</button>
        </div>
        <div id="historyList" style="width:100%; max-width:600px; margin:0 auto; overflow-y:auto; padding:20px; color:var(--text);"></div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz2sAhVj0OvaUW_90iDg4D0e7xgnJagQVIumqeYljT9h2IgA6GsJoHTo6d_ENsieEbW/exec'; 

        const MENU_DATA = [
            // TEA
            { category: "Tea", items: [
                { id: 1, name: 'Matcha Latte', price: 5500, cost: 4000, color: '#4CAF50', hasMilk: false, oatPrice: 0 },
                { id: 2, name: 'Matcha Strawberry', price: 7000, cost: 5000, color: '#E91E63', hasMilk: false, oatPrice: 0 },
                { id: 3, name: 'Matcha Coconut Cream', price: 7000, cost: 5000, color: '#009688', hasMilk: false, oatPrice: 0 },
                { id: 4, name: 'Matcha Egg Cream', price: 7000, cost: 5000, color: '#8BC34A', hasMilk: true, oatPrice: 500 },
                { id: 5, name: 'Coconut Matcha', price: 6000, cost: 4500, color: '#FFC107', hasMilk: false, oatPrice: 0 },
                { id: 6, name: 'Lime Tea', price: 3000, cost: 1500, color: '#CDDC39', hasMilk: false, oatPrice: 0 },
                { id: 7, name: 'Green Tea Milk', price: 4000, cost: 2500, color: '#8BC34A', hasMilk: true, oatPrice: 500 },
                { id: 8, name: 'Red Tea Milk', price: 4000, cost: 2500, color: '#FF5722', hasMilk: true, oatPrice: 500 }
            ]},
            // COFFEE
            { category: "Coffee", items: [
                { id: 9, name: 'Black Coffee', price: 3000, cost: 1500, color: '#3E2723', hasMilk: false, oatPrice: 0 },
                { id: 10, name: 'Coffee Condensed Milk', price: 4000, cost: 2500, color: '#795548', hasMilk: false, oatPrice: 0 },
                { id: 11, name: 'Coffee Coconut Cream', price: 7000, cost: 5000, color: '#5D4037', hasMilk: false, oatPrice: 0 },
                { id: 12, name: 'Coffee Egg Cream', price: 5500, cost: 4000, color: '#8D6E63', hasMilk: true, oatPrice: 500 }
            ]},
            // MIX / COCOA
            { category: "Mix", items: [
                { id: 13, name: 'Cocoa Milk', price: 4000, cost: 2500, color: '#6D4C41', hasMilk: false, oatPrice: 0 },
                { id: 14, name: 'Cocoa Coconut Cream', price: 7000, cost: 5000, color: '#4E342E', hasMilk: false, oatPrice: 0 }
            ]}
        ];

        // SAVE KEY 'v5' for menu updates
        let currentOrder = [];
        let todayRecords = JSON.parse(localStorage.getItem('myday_records_' + new Date().toDateString())) || [];
        let deviceName = localStorage.getItem('myday_device') || "Main Device";

        function renderMenu() {
            const container = document.getElementById('menuArea');
            container.innerHTML = '';
            MENU_DATA.forEach(grp => {
                grp.items.forEach(item => {
                    const btn = document.createElement('button');
                    btn.className = 'drink-btn';
                    btn.style.setProperty('--card-color', item.color);
                    btn.innerText = item.name;
                    btn.onclick = () => addToCart(item);
                    container.appendChild(btn);
                });
            });
        }

        function addToCart(item) {
            currentOrder.push({
                uid: Date.now() + Math.random(),
                ...item,
                milkOption: item.hasMilk ? 'Milk' : null,
                sweetness: '100%'
            });
            renderCart();
        }

        function renderCart() {
            const list = document.getElementById('cartList');
            const totalDisplay = document.getElementById('totalDisplay');
            const mobileSummary = document.getElementById('mobileSummary');
            
            list.innerHTML = '';
            
            let total = 0;
            let count = currentOrder.length;

            currentOrder.forEach(item => {
                let price = item.price;
                if(item.milkOption === 'Oat') price += item.oatPrice;
                total += price;

                const div = document.createElement('div');
                div.className = 'cart-item';
                div.innerHTML = `
                    <div class="item-left">
                        <span class="item-name">${item.name}</span>
                        ${item.hasMilk ? `
                        <select class="mini-select" onchange="updateItem('${item.uid}', 'milk', this.value)">
                            <option value="Milk" ${item.milkOption==='Milk'?'selected':''}>Milk</option>
                            <option value="Oat" ${item.milkOption==='Oat'?'selected':''}>Oat (+${item.oatPrice})</option>
                        </select>` : ''}
                        <select class="mini-select" onchange="updateItem('${item.uid}', 'sweet', this.value)">
                            <option value="100%" ${item.sweetness==='100%'?'selected':''}>100</option>
                            <option value="75%" ${item.sweetness==='75%'?'selected':''}>75</option>
                            <option value="50%" ${item.sweetness==='50%'?'selected':''}>50</option>
                            <option value="25%" ${item.sweetness==='25%'?'selected':''}>25</option>
                            <option value="0%" ${item.sweetness==='0%'?'selected':''}>0</option>
                        </select>
                    </div>
                    <div class="item-right">
                        <span class="item-price">${price.toLocaleString()}</span>
                        <button class="del-btn" onclick="removeItem('${item.uid}')">√ó</button>
                    </div>
                `;
                list.appendChild(div);
            });
            
            // Update Totals
            const totalStr = total.toLocaleString();
            totalDisplay.innerText = totalStr + " KHR";
            mobileSummary.innerText = `${count} Items ‚Ä¢ ${totalStr} KHR`;
            
            if(count === 0) list.innerHTML = '<div style="text-align:center; margin-top:40px; color:var(--text-sec);">Cart is empty</div>';
        }

        function updateItem(uid, key, val) {
            const item = currentOrder.find(i => i.uid == uid);
            if(key === 'milk') item.milkOption = val;
            if(key === 'sweet') item.sweetness = val;
            renderCart();
        }

        function removeItem(uid) {
            currentOrder = currentOrder.filter(i => i.uid != uid);
            renderCart();
        }

        function confirmOrder() {
            if(currentOrder.length === 0) return;
            openModal('Confirm Order', 'Send this to the kitchen?', () => {
                const now = new Date();
                const time = now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
                const date = now.toDateString();
                const oid = Date.now();
                
                const items = currentOrder.map(i => ({
                    date: date, time: time, id: oid,
                    name: `${i.name} (${i.sweetness})${i.milkOption ? ' '+i.milkOption : ''}`,
                    price: (i.milkOption==='Oat' ? i.price+i.oatPrice : i.price),
                    cost: i.cost, qty: 1, 
                    profit: (i.milkOption==='Oat' ? i.price+i.oatPrice : i.price) - i.cost
                }));

                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ user: deviceName, items: items })
                });

                const total = items.reduce((sum, i) => sum + i.price, 0);
                const grouped = {};
                items.forEach(i => {
                    if(!grouped[i.name]) grouped[i.name] = {qty:0};
                    grouped[i.name].qty++;
                });

                todayRecords.unshift({ id: oid, time: time, items: grouped, total: total });
                localStorage.setItem('myday_records_'+date, JSON.stringify(todayRecords));
                
                currentOrder = [];
                renderCart();
                document.getElementById('cartSheet').classList.remove('expanded');
            });
        }

        function confirmClear() {
            if(currentOrder.length === 0) return;
            openModal('Clear Cart', 'Remove all items?', () => {
                currentOrder = [];
                renderCart();
            });
        }

        function toggleCart() {
            if (window.innerWidth <= 768) {
                document.getElementById('cartSheet').classList.toggle('expanded');
            }
        }

        function openModal(title, text, action) {
            document.getElementById('mTitle').innerText = title;
            document.getElementById('mText').innerText = text;
            const btn = document.getElementById('mBtn');
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);
            newBtn.onclick = () => { action(); closeModal(); };
            
            const overlay = document.getElementById('modal');
            overlay.style.display = 'flex';
            setTimeout(() => overlay.classList.add('open'), 10);
        }
        function closeModal() { 
            const overlay = document.getElementById('modal');
            overlay.classList.remove('open');
            setTimeout(() => overlay.style.display = 'none', 300);
        }

        function openHistory() {
            const list = document.getElementById('historyList');
            let html = '';
            let total = 0;
            if(todayRecords.length === 0) html = '<div style="text-align:center; opacity:0.5; margin-top:40px;">No sales today</div>';
            else {
                todayRecords.forEach(r => {
                    total += r.total;
                    let desc = Object.keys(r.items).map(k => `${r.items[k].qty}x ${k}`).join(', ');
                    html += `
                    <div style="background:var(--surface); padding:16px; margin-bottom:12px; border-radius:var(--radius-md); box-shadow:var(--shadow-float);">
                        <div style="display:flex; justify-content:space-between; font-size:12px; opacity:0.6; margin-bottom:8px;">
                            <span>${r.time}</span><span>#${r.id.toString().slice(-4)}</span>
                        </div>
                        <div style="font-size:15px; margin-bottom:8px; line-height:1.4;">${desc}</div>
                        <div style="font-weight:800; color:var(--primary); text-align:right; font-size:16px;">${r.total.toLocaleString()}</div>
                    </div>`;
                });
                html = `<h2 style="text-align:center; margin-bottom:30px; font-size:24px;">Total: ${total.toLocaleString()}</h2>` + html;
            }
            list.innerHTML = html;
            const page = document.getElementById('historyPage');
            page.style.display = 'flex';
            setTimeout(() => page.classList.add('open'), 10);
        }
        function resetHistory() {
            openModal('Reset History', 'Are you sure you want to delete local history?', () => {
                todayRecords = [];
                localStorage.removeItem('myday_records_' + new Date().toDateString());
                openHistory(); 
            });
        }

        function toggleTheme() {
            const b = document.body;
            const mode = b.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            b.setAttribute('data-theme', mode);
            localStorage.setItem('myday_theme', mode);
            document.getElementById('themeBtn').innerText = mode==='dark'?'‚òÄÔ∏è':'üåô';
        }
        
        const savedTheme = localStorage.getItem('myday_theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('themeBtn').innerText = savedTheme==='dark'?'‚òÄÔ∏è':'üåô';
        renderMenu();
    </script>
</body>
</html>
