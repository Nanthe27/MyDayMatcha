<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Day Matcha</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #f5f5f5; 
            margin: 0; padding: 0; 
            min-height: 100vh;
        }
        
        /* TOP BAR */
        .top-bar {
            background: #4CAF50; 
            color: white; 
            padding: 15px 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .top-bar h1 {
            margin: 0; 
            font-size: 28px; 
            font-weight: bold;
        }
        .top-bar .export-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .top-bar .export-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-1px);
        }
        
        .main-container { 
            display: flex; 
            gap: 20px; 
            margin: 20px auto; 
            max-width: 1200px;
        }
        .order-section { 
            flex: 2; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .records { 
            flex: 1; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            height: fit-content; 
        }
        .menu-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .drink-btn { 
            color: white; 
            border: none; 
            padding: 15px; 
            border-radius: 12px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s; 
            position: relative; 
            overflow: hidden; 
        }
        .drink-btn::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: -100%; 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); 
            transition: left 0.5s; 
        }
        .drink-btn:hover::before { left: 100%; }
        .drink-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.3); 
        }
        /* Unique colors for each drink */
        .matcha-latte { background: #4CAF50; }
        .matcha-strawberry { background: #FF6B9D; }
        .matcha-coconut-cream { background: #26C6DA; }
        .coconut-matcha { background: #FFCA28; color: #333 !important; }
        .coffee-condensed { background: #8B4513; }
        .black-coffee { background: #1B1B1B; }
        .order-list { 
            max-height: 400px; 
            overflow-y: auto; 
            border: 1px solid #ddd; 
            padding: 10px; 
            border-radius: 5px; 
        }
        .order-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 8px 0; 
            border-bottom: 1px solid #eee; 
        }
        .order-item-left { 
            display: flex; 
            flex: 1; 
            gap: 8px; 
            align-items: center; 
            flex-wrap: wrap; 
        }
        .dropdown-select { 
            padding: 4px 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 11px; 
            min-width: 60px; 
        }
        .qty-btn { 
            background: #ddd; 
            border: none; 
            width: 28px; 
            height: 28px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold; 
        }
        .qty-btn:hover { background: #ccc; }
        .controls { 
            display: flex; 
            gap: 10px; 
            margin: 10px 0; 
            flex-wrap: wrap; 
        }
        .btn { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px; 
        }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #666; color: white; }
        .btn-success { background: #28a745; color: white; }
        .total { 
            font-size: 24px; 
            font-weight: bold; 
            color: #4CAF50; 
            text-align: right; 
            margin: 20px 0; 
        }
        .record-list { max-height: 400px; overflow-y: auto; }
        .record-item { 
            padding: 10px; 
            border-bottom: 1px solid #eee; 
            margin-bottom: 10px; 
            position: relative; 
        }
        .record-header { 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 5px; 
        }
        .record-drinks { 
            font-size: 14px; 
            color: #666; 
            line-height: 1.4; 
        }
        .delete-record { 
            background: #f44336; 
            color: white; 
            border: none; 
            width: 20px; 
            height: 20px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 12px; 
            margin-left: 10px; 
        }
        .delete-record:hover { background: #d32f2f; }
        .daily-total { 
            font-weight: bold; 
            padding-top: 15px; 
            border-top: 2px solid #4CAF50; 
            text-align: center; 
            margin-top: 10px; 
        }
        .record-controls { display: flex; gap: 5px; margin-top: 10px; }
        
        @media (max-width: 768px) { 
            .top-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            .main-container { flex-direction: column; }
            .menu-grid { grid-template-columns: 1fr; }
            .order-item { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 10px; 
            }
            .order-item-left { 
                width: 100%; 
                justify-content: space-between; 
                flex-direction: column; 
            }
        }
    </style>
</head>
<body>
    <!-- TOP BAR WITH EXPORT BUTTON -->
    <div class="top-bar">
        <h1>My Day Matcha</h1>
        <button class="export-btn" onclick="exportToExcel()">üìä Export</button>
    </div>

    <div class="main-container">
        <div class="order-section">
            <h2>üõí Current Order</h2>
            <div class="menu-grid">
                <button class="drink-btn matcha-latte" onclick="addDrink('Matcha Latte', 5500, true)">ü•õ Matcha Latte<br><span style="font-size:14px">5,500 KHR</span></button>
                <button class="drink-btn matcha-strawberry" onclick="addDrink('Matcha Strawberry', 7000, true)">üçì Matcha Strawberry<br><span style="font-size:14px">7,000 KHR</span></button>
                <button class="drink-btn matcha-coconut-cream" onclick="addDrink('Matcha Coconut Cream', 7000, false)">Matcha Coconut Cream<br><span style="font-size:14px">7,000 KHR</span></button>
                <button class="drink-btn coconut-matcha" onclick="addDrink('Coconut Matcha', 6000, false)">ü•• Coconut Matcha<br><span style="font-size:14px">6,000 KHR</span></button>
                <button class="drink-btn coffee-condensed" onclick="addDrink('Coffee Condensed Milk', 4000, false)">ü•õ Coffee Condensed Milk<br><span style="font-size:14px">4,000 KHR</span></button>
                <button class="drink-btn black-coffee" onclick="addDrink('Black Coffee', 3000, false)">‚òï Black Coffee<br><span style="font-size:14px">3,000 KHR</span></button>
            </div>
            
            <div class="order-list" id="orderList"></div>
            <div class="total" id="total">Total: 0 KHR</div>
            <div class="controls">
                <button class="btn btn-primary" onclick="completeOrder()">‚úÖ Complete Sale</button>
                <button class="btn btn-secondary" onclick="clearOrder()">üóëÔ∏è Clear Order</button>
            </div>
        </div>

        <div class="records">
            <h2>üìä Today Records</h2>
            <div class="record-list" id="recordList">
                <p>No sales recorded yet today.</p>
            </div>
            <div class="record-controls">
                <button class="btn btn-secondary" onclick="clearRecords()">Clear All Records</button>
            </div>
        </div>
    </div>

    <script>
        let currentOrder = [];
        let orderIndex = 0;
        let todayRecords = JSON.parse(localStorage.getItem('cafeRecords_' + new Date().toDateString())) || [];
        const sweetnessLevels = ['100%', '75%', '50%', '30%', '10%', '0%'];
        const milkOptions = ['Milk', 'Oat Milk'];
        // REMOVED Matcha Coconut Cream from milkDrinks - NO MILK DROPDOWN
        const milkDrinks = ['Matcha Latte', 'Matcha Strawberry'];

        // ALL FUNCTIONS SAME
        function addDrink(name, price, hasMilk) {
            currentOrder.push({
                id: orderIndex++,
                name: name, 
                price: price, 
                sweetness: '100%',
                milk: hasMilk ? 'Milk' : null,
                qty: 1
            });
            updateOrderDisplay();
        }

        function updateOrderDisplay() {
            const list = document.getElementById('orderList');
            const total = document.getElementById('total');
            
            let html = '';
            let subtotal = 0;
            
            const grouped = {};
            currentOrder.forEach(item => {
                const key = `${item.name}-${item.sweetness}${item.milk ? '-' + item.milk : ''}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        id: item.id,
                        name: item.name, 
                        sweetness: item.sweetness, 
                        milk: item.milk,
                        price: item.price, 
                        qty: 0,
                        total: 0
                    };
                }
                grouped[key].qty++;
                grouped[key].total += item.price;
            });
            
            for (let key in grouped) {
                const item = grouped[key];
                html += `
                    <div class="order-item">
                        <div class="order-item-left">
                            <span>${item.name}</span>
                            ${item.milk ? `
                                <select class="dropdown-select" onchange="updateMilk(${item.id}, this.value)">
                                    ${milkOptions.map(option => 
                                        `<option value="${option}" ${option === item.milk ? 'selected' : ''}>${option}</option>`
                                    ).join('')}
                                </select>
                            ` : ''}
                            <select class="dropdown-select" onchange="updateSweetness(${item.id}, this.value)">
                                ${sweetnessLevels.map(level => 
                                    `<option value="${level}" ${level === item.sweetness ? 'selected' : ''}>${level}</option>`
                                ).join('')}
                            </select>
                            <span>x${item.qty}</span>
                        </div>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <span>${item.total.toLocaleString()} KHR</span>
                            <button class="qty-btn" onclick="removeItem(${item.id})">‚àí</button>
                        </div>
                    </div>`;
                subtotal += item.total;
            }
            
            list.innerHTML = html || '<p>No items added yet.</p>';
            total.textContent = `Total: ${subtotal.toLocaleString()} KHR`;
        }

        function updateSweetness(id, newSweetness) {
            const drinkName = currentOrder.find(item => item.id === id).name;
            currentOrder.forEach(item => {
                if (item.name === drinkName) {
                    item.sweetness = newSweetness;
                }
            });
            updateOrderDisplay();
        }

        function updateMilk(id, newMilk) {
            const item = currentOrder.find(item => item.id === id);
            if (milkDrinks.includes(item.name)) {
                item.milk = newMilk;
            }
            updateOrderDisplay();
        }

        function removeItem(id) {
            currentOrder = currentOrder.filter(item => item.id !== id);
            updateOrderDisplay();
        }

        function completeOrder() {
            if (currentOrder.length === 0) {
                return; // SILENT
            }
            
            const subtotal = currentOrder.reduce((sum, item) => sum + item.price, 0);
            const groupedOrder = {};
            currentOrder.forEach(item => {
                let key = `${item.name} (${item.sweetness})`;
                if (item.milk && item.name !== 'Coffee Condensed Milk') key += ` ${item.milk}`;
                if (!groupedOrder[key]) groupedOrder[key] = {qty: 0};
                groupedOrder[key].qty++;
            });
            
            const record = {
                id: Date.now(),
                time: new Date().toLocaleString('en-US', {timeZone: 'Asia/Phnom_Penh'}),
                drinks: groupedOrder,
                total: subtotal,
                itemCount: currentOrder.length
            };
            
            todayRecords.unshift(record);
            localStorage.setItem('cafeRecords_' + new Date().toDateString(), JSON.stringify(todayRecords));
            currentOrder = [];
            orderIndex = 0;
            updateOrderDisplay();
            updateRecordsDisplay();
        }

        function updateRecordsDisplay() {
            const list = document.getElementById('recordList');
            if (todayRecords.length === 0) {
                list.innerHTML = '<p>No sales recorded yet today.</p>';
                return;
            }
            
            let html = '';
            let dailyTotal = 0;
            let totalSales = 0;
            
            todayRecords.forEach(record => {
                let drinksHtml = '';
                for (let drink in record.drinks) {
                    drinksHtml += `${drink} x${record.drinks[drink].qty}, `;
                }
                drinksHtml = drinksHtml.slice(0, -2);
                
                html += `<div class="record-item">
                    <div class="record-header">
                        <span>${record.time}</span>
                        <button class="delete-record" onclick="deleteRecord(${record.id})" title="Delete">√ó</button>
                        <span>${record.total.toLocaleString()} KHR</span>
                    </div>
                    <div class="record-drinks">${drinksHtml}</div>
                </div>`;
                dailyTotal += record.total;
                totalSales++;
            });
            
            html += `<div class="daily-total">
                Today Total: ${dailyTotal.toLocaleString()} KHR<br>
                <small>(${totalSales} sales, ${todayRecords.reduce((sum, r) => sum + r.itemCount, 0)} drinks)</small>
            </div>`;
            list.innerHTML = html;
        }

        function exportToExcel() {
            if (todayRecords.length === 0) {
                alert('No records to export!');
                return;
            }
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Date,Time,Drinks,Total KHR,Items\n";
            todayRecords.forEach(record => {
                let drinksList = '';
                for (let drink in record.drinks) {
                    drinksList += `${drink} x${record.drinks[drink].qty}; `;
                }
                csvContent += `"${new Date().toDateString()}",${record.time},"${drinksList}",${record.total},${record.itemCount}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `MyDayMatcha_${new Date().toDateString()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function deleteRecord(recordId) {
            if (confirm('Delete this record?')) {
                todayRecords = todayRecords.filter(record => record.id !== recordId);
                localStorage.setItem('cafeRecords_' + new Date().toDateString(), JSON.stringify(todayRecords));
                updateRecordsDisplay();
            }
        }

        function clearOrder() {
            currentOrder = [];
            orderIndex = 0;
            updateOrderDisplay();
        }

        function clearRecords() {
            if (confirm('Clear all today records?')) {
                todayRecords = [];
                localStorage.removeItem('cafeRecords_' + new Date().toDateString());
                updateRecordsDisplay();
            }
        }

        updateOrderDisplay();
        updateRecordsDisplay();
    </script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  let tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand(); // Makes app fullscreen
</script>
</body>
</html>

